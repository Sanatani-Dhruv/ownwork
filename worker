#!/usr/bin/env php
<?php

global $argv;

require __DIR__ . "/app/Helper/ConsoleHelper.php";
use App\Helper\ConsoleHelper;

$printer = new ConsoleHelper();

function help() {
	echo 'Usage: php worker [OPTION]...
Executing Commands for easy components management - OwnWork

OPTIONS:
make - Making Components, it arguments:
    > controller - Make Controller File
    > model - Make Model File
    > view - Make View File
';
}

// print_r($argv);
// echo "\n";
$dirArray = [
	'controller' => __DIR__ . "/app/Controller/",
	'view' => __DIR__ . "/resources/views/",
	'model' => __DIR__ . "/app/Model/"
];

$baseDirArray = [
	'controller' => "app/Controller/",
	'view' => "resources/views/",
	'model' => "app/Model/"
];

$baseFileArray = [
	'controller' => __DIR__ . "/app/Helper/Controller.php",
	'view' => __DIR__ . "/app/Helper/View.php",
	'model' => __DIR__ . "/app/Helper/Model.php"
];

$array_list = [$dirArray, $baseDirArray, $baseFileArray];

$firstArg = (isset($argv[1])) ? $argv[1] : false;
$validFirstArg = false;

foreach ($dirArray as $key => $value) {
	if (!is_dir($value)) {
		mkdir($value, 0664);
	}
}

if ($firstArg && $firstArg == "make") {
	$validFirstArg = true;
	if (isset($argv[2])) {
		$dirName = strtolower($argv[2]);
		switch ($dirName) {
		case 'controller':
			compCreate($array_list, $dirName);
			break;
		case 'model':
			compCreate($array_list, $dirName);
			break;
		case 'view':
			compCreate($array_list, $dirName);
			break;
		default:
			echo "No Such Component Exists\n\n";
			help();
			break;
		}
	} else {
		echo "Provide Name of Component to make!\n\n";
		help();
	}
} else {
	//
}

function compCreate($arrList, $component, $compName = null) {
	global $argv;
	$compName = (isset($argv[3])) ? $argv[3] : trim(readline("Enter " . $component ." name: "));
	if (!file_exists($arrList[0][$component] . $compName . ".php")) {
		touch($arrList[0][$component] . $compName . ".php");
		$templateContent = str_replace('DEFAULT_NAME', $compName, file_get_contents($arrList[2][$component]));
		file_put_contents($arrList[0][$component]. $compName . ".php", $templateContent);
		echo "\n" . ucfirst($component) . " with name `$compName.php` created at: \n\n";
		echo "-> " . $arrList[1][$component] . $compName . ".php\n";
	} else {
		echo "Component with name $compName Already exists at:\n\n";
		echo "-> " . $arrList[1][$component] . $compName . ".php\n";
	}
}

if (!$firstArg) {
	help();
}

if ($firstArg && !$validFirstArg) {
	echo "No Registered Command as \"$argv[1]\"!\n\n";
	help();
}
